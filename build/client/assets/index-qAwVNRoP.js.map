{"version":3,"file":"index-qAwVNRoP.js","sources":["../../../app/routes/users+/index.tsx"],"sourcesContent":["import { json, redirect, type LoaderFunctionArgs } from '@remix-run/node'\nimport { Link, useLoaderData } from '@remix-run/react'\nimport { z } from 'zod'\nimport { GeneralErrorBoundary } from '#app/components/error-boundary.tsx'\nimport { ErrorList } from '#app/components/forms.tsx'\nimport { SearchBar } from '#app/components/search-bar.tsx'\nimport { prisma } from '#app/utils/db.server.ts'\nimport { cn, getUserImgSrc, useDelayedIsPending } from '#app/utils/misc.tsx'\n\nconst UserSearchResultSchema = z.object({\n\tid: z.string(),\n\tusername: z.string(),\n\tname: z.string().nullable(),\n\timageId: z.string().nullable(),\n})\n\nconst UserSearchResultsSchema = z.array(UserSearchResultSchema)\n\nexport async function loader({ request }: LoaderFunctionArgs) {\n\tconst searchTerm = new URL(request.url).searchParams.get('search')\n\tif (searchTerm === '') {\n\t\treturn redirect('/users')\n\t}\n\n\tconst like = `%${searchTerm ?? ''}%`\n\tconst rawUsers = await prisma.$queryRaw`\n\t\tSELECT User.id, User.username, User.name, UserImage.id AS imageId\n\t\tFROM User\n\t\tLEFT JOIN UserImage ON User.id = UserImage.userId\n\t\tWHERE User.username LIKE ${like}\n\t\tOR User.name LIKE ${like}\n\t\tORDER BY (\n\t\t\tSELECT Note.updatedAt\n\t\t\tFROM Note\n\t\t\tWHERE Note.ownerId = User.id\n\t\t\tORDER BY Note.updatedAt DESC\n\t\t\tLIMIT 1\n\t\t) DESC\n\t\tLIMIT 50\n\t`\n\n\tconst result = UserSearchResultsSchema.safeParse(rawUsers)\n\tif (!result.success) {\n\t\treturn json({ status: 'error', error: result.error.message } as const, {\n\t\t\tstatus: 400,\n\t\t})\n\t}\n\treturn json({ status: 'idle', users: result.data } as const)\n}\n\nexport default function UsersRoute() {\n\tconst data = useLoaderData<typeof loader>()\n\tconst isPending = useDelayedIsPending({\n\t\tformMethod: 'GET',\n\t\tformAction: '/users',\n\t})\n\n\tif (data.status === 'error') {\n\t\tconsole.error(data.error)\n\t}\n\n\treturn (\n\t\t<div className=\"container mb-48 mt-36 flex flex-col items-center justify-center gap-6\">\n\t\t\t<h1 className=\"text-h1\">Epic Notes Users</h1>\n\t\t\t<div className=\"w-full max-w-[700px]\">\n\t\t\t\t<SearchBar status={data.status} autoFocus autoSubmit />\n\t\t\t</div>\n\t\t\t<main>\n\t\t\t\t{data.status === 'idle' ? (\n\t\t\t\t\tdata.users.length ? (\n\t\t\t\t\t\t<ul\n\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t'flex w-full flex-wrap items-center justify-center gap-4 delay-200',\n\t\t\t\t\t\t\t\t{ 'opacity-50': isPending },\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{data.users.map(user => (\n\t\t\t\t\t\t\t\t<li key={user.id}>\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\tto={user.username}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex h-36 w-44 flex-col items-center justify-center rounded-lg bg-muted px-5 py-3\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\talt={user.name ?? user.username}\n\t\t\t\t\t\t\t\t\t\t\tsrc={getUserImgSrc(user.imageId)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-16 w-16 rounded-full\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{user.name ? (\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"w-full overflow-hidden text-ellipsis whitespace-nowrap text-center text-body-md\">\n\t\t\t\t\t\t\t\t\t\t\t\t{user.name}\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t\t\t\t\t<span className=\"w-full overflow-hidden text-ellipsis text-center text-body-sm text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t{user.username}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<p>No users found</p>\n\t\t\t\t\t)\n\t\t\t\t) : data.status === 'error' ? (\n\t\t\t\t\t<ErrorList errors={['There was an error parsing the results']} />\n\t\t\t\t) : null}\n\t\t\t</main>\n\t\t</div>\n\t)\n}\n\nexport function ErrorBoundary() {\n\treturn <GeneralErrorBoundary />\n}\n"],"names":["UsersRoute","data","useLoaderData","isPending","jsxs","jsx","SearchBar","cn","user","Link","getUserImgSrc","ErrorList","GeneralErrorBoundary"],"mappings":"iiBAK0B,SAAAA,GAAA,CAC1B,MAAAC,EAAuBC,IACdC,IAA8C,CAEjD,WAAA,MACL,WAAa,QAAA,CACb,EACA,OAAMF,EAAS,SAAW,SACjB,QAAA,MAASA,EAAW,KAAA,EAGxBG,EAAAA,KAAA,MAA4B,CAEZ,UAAA,wEACf,SAAA,CAAqBC,EAAA,IAAA,KAAW,CAClC,oBACH,2BAAwB,CACzB,EAAAA,EAAA,IAAA,MAAA,CAEM,UAAW,uBACX,SAAwBA,EAAA,IAAAC,EAAA,CAAA,OAAAL,EAAA,OAAA,UAAA,GAAA,WAAA,EAAA,CAAA,CAIE,CAAA,EACPI,EAAA,IAAA,OAAA,CAAA,SAAAJ,EAAA,SAAA,OAAAA,EAAA,MAAA,OAAAI,EAAA,IAAA,KAAA,CAAA,UAAAE,EAAA,oEAAA,CAAA,aAAAJ,CAAA,CAAA,EAAA,SAAAF,EAAA,MAAA,IAAAO,GAAAH,EAAA,IAAA,KAAA,CAAA,SAAAD,EAAA,KAAAK,EAAA,CAAA,GAAAD,EAAA,SAAA,UAAA,oFAAA,SAAA,CAAAH,EAAA,IAAA,MAAA,CAWnB,IAAiCG,EAAA,MAAAA,EAAA,SAC3B,IAASE,EAAAF,EAAA,OAAA,EACb,UAAe,wBACb,CAAA,EAAAA,EAAA,KAAAH,EAAAA,IAAA,OAAA,CACR,UAAA,kFACF,SAAAG,EAAA,IACA,GAAc,KAAuBH,EAAA,IAAA,QACtC,UAAA,sFAEA,SAAwBG,EAAa,QACpC,GACA,EAAsC,EACzBA,EAAA,EAAA,CAAA,CAAA,CACA,EAAAH,EAAA,IAAA,IAAA,CACZ,SAAA,gBAEG,CAAA,EAAKJ,WAAoB,QAAAI,EAAAA,IAAAM,EAAA,CACpB,OAAA,CAAA,wCAAgB,CACzB,CAAA,EAAA,IAEA,CACC,CAAA,CACC,CAAC,CAAuC,aAKtC,CAEE,OAAAN,EAAA,IAAAO,EAAA,CAAA,CAAA,CAAA"}